purpose: USB Data Packet Definitions

hex
headers

d# 128 constant #max-dev
1A42E24 	 0  0  0 23 
1A42E28 	6D 61 78 2D 64 65 76 88 
1A42E30 	1C 2E A4  1 68 40 A0  1 
1A42E38 	80  0  0  0 
d#  16 constant #max-endpoint
1A42E3C 	 0  0 23 6D 
1A42E40 	61 78 2D 65 6E 64 70 6F 
1A42E48 	69 6E 74 8D 34 2E A4  1 
1A42E50 	68 40 A0  1 10  0  0  0 

0 constant speed-full
1A42E58 	 0 73 70 65 65 64 2D 66 
1A42E60 	75 6C 6C 8A 50 2E A4  1 
1A42E68 	68 40 A0  1  0  0  0  0 
1 constant speed-low
1A42E70 	 0  0 73 70 65 65 64 2D 
1A42E78 	6C 6F 77 89 68 2E A4  1 
1A42E80 	68 40 A0  1  1  0  0  0 
2 constant speed-high
1A42E88 	 0 73 70 65 65 64 2D 68 
1A42E90 	69 67 68 8A 80 2E A4  1 
1A42E98 	68 40 A0  1  2  0  0  0 

    8 constant /pipe0
1A42EA0 	 0 2F 70 69 70 65 30 86 
1A42EA8 	98 2E A4  1 68 40 A0  1 
1A42EB0 	 8  0  0  0 
10000 constant /cfg
1A42EB4 	 0  0  0 2F 
1A42EB8 	63 66 67 84 AC 2E A4  1 
1A42EC0 	68 40 A0  1  0  0  1  0 
  100 constant /str
1A42EC8 	 0  0  0 2F 73 74 72 84 
1A42ED0 	C0 2E A4  1 68 40 A0  1 
1A42ED8 	 0  1  0  0 

\ Structure of devices requests as defined in USB spec.
struct  ( standard device requests )
1 field >dr-rtype			\ bmRequestType
1A42EDC 	 0  0 3E 64 
1A42EE0 	72 2D 72 74 79 70 65 89 
1A42EE8 	D4 2E A4  1 50 EE A0  1 
1A42EF0 	 0  0  0  0 
1 field >dr-request			\ bRequest
1A42EF4 	3E 64 72 2D 
1A42EF8 	72 65 71 75 65 73 74 8B 
1A42F00 	EC 2E A4  1 50 EE A0  1 
1A42F08 	 1  0  0  0 
2 field >dr-value			\ wValue
1A42F0C 	 0  0 3E 64 
1A42F10 	72 2D 76 61 6C 75 65 89 
1A42F18 	 4 2F A4  1 50 EE A0  1 
1A42F20 	 2  0  0  0 
2 field >dr-index			\ wIndex
1A42F24 	 0  0 3E 64 
1A42F28 	72 2D 69 6E 64 65 78 89 
1A42F30 	1C 2F A4  1 50 EE A0  1 
1A42F38 	 4  0  0  0 
2 field >dr-len				\ wLength
1A42F3C 	3E 64 72 2D 
1A42F40 	6C 65 6E 87 34 2F A4  1 
1A42F48 	50 EE A0  1  6  0  0  0 
					\ Data
constant /dr
1A42F50 	2F 64 72 83 48 2F A4  1 
1A42F58 	68 40 A0  1  8  0  0  0 

\ >dr-type constants
00 constant DR_OUT
1A42F60 	 0 64 72 5F 6F 75 74 86 
1A42F68 	58 2F A4  1 68 40 A0  1 
1A42F70 	 0  0  0  0 
80 constant DR_IN
1A42F74 	 0  0 64 72 
1A42F78 	5F 69 6E 85 6C 2F A4  1 
1A42F80 	68 40 A0  1 80  0  0  0 
00 constant DR_STANDARD
1A42F88 	64 72 5F 73 74 61 6E 64 
1A42F90 	61 72 64 8B 80 2F A4  1 
1A42F98 	68 40 A0  1  0  0  0  0 
20 constant DR_CLASS
1A42FA0 	 0  0  0 64 72 5F 63 6C 
1A42FA8 	61 73 73 88 98 2F A4  1 
1A42FB0 	68 40 A0  1 20  0  0  0 
40 constant DR_VENDOR
1A42FB8 	 0  0 64 72 5F 76 65 6E 
1A42FC0 	64 6F 72 89 B0 2F A4  1 
1A42FC8 	68 40 A0  1 40  0  0  0 
00 constant DR_DEVICE
1A42FD0 	 0  0 64 72 5F 64 65 76 
1A42FD8 	69 63 65 89 C8 2F A4  1 
1A42FE0 	68 40 A0  1  0  0  0  0 
01 constant DR_INTERFACE
1A42FE8 	 0  0  0 64 72 5F 69 6E 
1A42FF0 	74 65 72 66 61 63 65 8C 
1A42FF8 	E0 2F A4  1 68 40 A0  1 
1A43000 	 1  0  0  0 
02 constant DR_ENDPOINT
1A43004 	64 72 5F 65 
1A43008 	6E 64 70 6F 69 6E 74 8B 
1A43010 	FC 2F A4  1 68 40 A0  1 
1A43018 	 2  0  0  0 
03 constant DR_OTHERS
1A4301C 	 0  0 64 72 
1A43020 	5F 6F 74 68 65 72 73 89 
1A43028 	14 30 A4  1 68 40 A0  1 
1A43030 	 3  0  0  0 
DR_CLASS DR_DEVICE    or constant DR_HUB
1A43034 	 0 64 72 5F 
1A43038 	68 75 62 86 2C 30 A4  1 
1A43040 	68 40 A0  1 20  0  0  0 
DR_CLASS DR_OTHERS    or constant DR_PORT
1A43048 	64 72 5F 70 6F 72 74 87 
1A43050 	40 30 A4  1 68 40 A0  1 
1A43058 	23  0  0  0 
DR_CLASS DR_INTERFACE or constant DR_HIDD
1A4305C 	64 72 5F 68 
1A43060 	69 64 64 87 54 30 A4  1 
1A43068 	68 40 A0  1 21  0  0  0 

\ >dr-request constants
01 constant CLEAR_FEATURE
1A43070 	 0  0 63 6C 65 61 72 5F 
1A43078 	66 65 61 74 75 72 65 8D 
1A43080 	68 30 A4  1 68 40 A0  1 
1A43088 	 1  0  0  0 
08 constant GET_CONFIGURATION
1A4308C 	 0  0 67 65 
1A43090 	74 5F 63 6F 6E 66 69 67 
1A43098 	75 72 61 74 69 6F 6E 91 
1A430A0 	84 30 A4  1 68 40 A0  1 
1A430A8 	 8  0  0  0 
06 constant GET_DESCRIPTOR
1A430AC 	 0 67 65 74 
1A430B0 	5F 64 65 73 63 72 69 70 
1A430B8 	74 6F 72 8E A4 30 A4  1 
1A430C0 	68 40 A0  1  6  0  0  0 
0a constant GET_INTERFACE
1A430C8 	 0  0 67 65 74 5F 69 6E 
1A430D0 	74 65 72 66 61 63 65 8D 
1A430D8 	C0 30 A4  1 68 40 A0  1 
1A430E0 	 A  0  0  0 
02 constant GET_STATE
1A430E4 	 0  0 67 65 
1A430E8 	74 5F 73 74 61 74 65 89 
1A430F0 	DC 30 A4  1 68 40 A0  1 
1A430F8 	 2  0  0  0 
00 constant GET_STATUS
1A430FC 	 0 67 65 74 
1A43100 	5F 73 74 61 74 75 73 8A 
1A43108 	F4 30 A4  1 68 40 A0  1 
1A43110 	 0  0  0  0 
05 constant SET_ADDRESS
1A43114 	73 65 74 5F 
1A43118 	61 64 64 72 65 73 73 8B 
1A43120 	 C 31 A4  1 68 40 A0  1 
1A43128 	 5  0  0  0 
09 constant SET_CONFIGURATION
1A4312C 	 0  0 73 65 
1A43130 	74 5F 63 6F 6E 66 69 67 
1A43138 	75 72 61 74 69 6F 6E 91 
1A43140 	24 31 A4  1 68 40 A0  1 
1A43148 	 9  0  0  0 
07 constant SET_DESCRIPTOR
1A4314C 	 0 73 65 74 
1A43150 	5F 64 65 73 63 72 69 70 
1A43158 	74 6F 72 8E 44 31 A4  1 
1A43160 	68 40 A0  1  7  0  0  0 
03 constant SET_FEATURE
1A43168 	73 65 74 5F 66 65 61 74 
1A43170 	75 72 65 8B 60 31 A4  1 
1A43178 	68 40 A0  1  3  0  0  0 
0b constant SET_INTERFACE
1A43180 	 0  0 73 65 74 5F 69 6E 
1A43188 	74 65 72 66 61 63 65 8D 
1A43190 	78 31 A4  1 68 40 A0  1 
1A43198 	 B  0  0  0 
0c constant SYNCH_FRAME
1A4319C 	73 79 6E 63 
1A431A0 	68 5F 66 72 61 6D 65 8B 
1A431A8 	94 31 A4  1 68 40 A0  1 
1A431B0 	 C  0  0  0 

\ >dr-value (upper byte) for get-/set-descriptor constants
\ lower-byte is descriptor index
01 constant DEVICE
1A431B4 	 0 64 65 76 
1A431B8 	69 63 65 86 AC 31 A4  1 
1A431C0 	68 40 A0  1  1  0  0  0 
02 constant CONFIGURATION
1A431C8 	 0  0 63 6F 6E 66 69 67 
1A431D0 	75 72 61 74 69 6F 6E 8D 
1A431D8 	C0 31 A4  1 68 40 A0  1 
1A431E0 	 2  0  0  0 
03 constant STRING
1A431E4 	 0 73 74 72 
1A431E8 	69 6E 67 86 DC 31 A4  1 
1A431F0 	68 40 A0  1  3  0  0  0 
04 constant INTERFACE
1A431F8 	 0  0 69 6E 74 65 72 66 
1A43200 	61 63 65 89 F0 31 A4  1 
1A43208 	68 40 A0  1  4  0  0  0 
05 constant ENDPOINT
1A43210 	 0  0  0 65 6E 64 70 6F 
1A43218 	69 6E 74 88  8 32 A4  1 
1A43220 	68 40 A0  1  5  0  0  0 
0b constant INTERFACE_ASSO
1A43228 	 0 69 6E 74 65 72 66 61 
1A43230 	63 65 5F 61 73 73 6F 8E 
1A43238 	20 32 A4  1 68 40 A0  1 
1A43240 	 B  0  0  0 
29 constant HUB
1A43244 	68 75 62 83 
1A43248 	3C 32 A4  1 68 40 A0  1 
1A43250 	29  0  0  0 

\ Hub Class Feature Selectors (dr-value)
00 constant C_HUB_LOCAL_POWER
1A43254 	 0  0 63 5F 
1A43258 	68 75 62 5F 6C 6F 63 61 
1A43260 	6C 5F 70 6F 77 65 72 91 
1A43268 	4C 32 A4  1 68 40 A0  1 
1A43270 	 0  0  0  0 
01 constant C_HUB_OVER_CURRENT
1A43274 	 0 63 5F 68 
1A43278 	75 62 5F 6F 76 65 72 5F 
1A43280 	63 75 72 72 65 6E 74 92 
1A43288 	6C 32 A4  1 68 40 A0  1 
1A43290 	 1  0  0  0 
00 constant PORT_CONNECTION
1A43294 	70 6F 72 74 
1A43298 	5F 63 6F 6E 6E 65 63 74 
1A432A0 	69 6F 6E 8F 8C 32 A4  1 
1A432A8 	68 40 A0  1  0  0  0  0 
01 constant PORT_ENABLE
1A432B0 	70 6F 72 74 5F 65 6E 61 
1A432B8 	62 6C 65 8B A8 32 A4  1 
1A432C0 	68 40 A0  1  1  0  0  0 
02 constant PORT_SUSPEND
1A432C8 	 0  0  0 70 6F 72 74 5F 
1A432D0 	73 75 73 70 65 6E 64 8C 
1A432D8 	C0 32 A4  1 68 40 A0  1 
1A432E0 	 2  0  0  0 
03 constant PORT_OVER_CURRENT
1A432E4 	 0  0 70 6F 
1A432E8 	72 74 5F 6F 76 65 72 5F 
1A432F0 	63 75 72 72 65 6E 74 91 
1A432F8 	DC 32 A4  1 68 40 A0  1 
1A43300 	 3  0  0  0 
04 constant PORT_RESET
1A43304 	 0 70 6F 72 
1A43308 	74 5F 72 65 73 65 74 8A 
1A43310 	FC 32 A4  1 68 40 A0  1 
1A43318 	 4  0  0  0 
08 constant PORT_POWER
1A4331C 	 0 70 6F 72 
1A43320 	74 5F 70 6F 77 65 72 8A 
1A43328 	14 33 A4  1 68 40 A0  1 
1A43330 	 8  0  0  0 
09 constant PORT_LOW_SPEED
1A43334 	 0 70 6F 72 
1A43338 	74 5F 6C 6F 77 5F 73 70 
1A43340 	65 65 64 8E 2C 33 A4  1 
1A43348 	68 40 A0  1  9  0  0  0 
d# 16 constant C_PORT_CONNECTION
1A43350 	 0  0 63 5F 70 6F 72 74 
1A43358 	5F 63 6F 6E 6E 65 63 74 
1A43360 	69 6F 6E 91 48 33 A4  1 
1A43368 	68 40 A0  1 10  0  0  0 
d# 17 constant C_PORT_ENABLE
1A43370 	 0  0 63 5F 70 6F 72 74 
1A43378 	5F 65 6E 61 62 6C 65 8D 
1A43380 	68 33 A4  1 68 40 A0  1 
1A43388 	11  0  0  0 
d# 18 constant C_PORT_SUSPEND
1A4338C 	 0 63 5F 70 
1A43390 	6F 72 74 5F 73 75 73 70 
1A43398 	65 6E 64 8E 84 33 A4  1 
1A433A0 	68 40 A0  1 12  0  0  0 
d# 19 constant C_PORT_OVER_CURRENT
1A433A8 	63 5F 70 6F 72 74 5F 6F 
1A433B0 	76 65 72 5F 63 75 72 72 
1A433B8 	65 6E 74 93 A0 33 A4  1 
1A433C0 	68 40 A0  1 13  0  0  0 
d# 20 constant C_PORT_RESET
1A433C8 	 0  0  0 63 5F 70 6F 72 
1A433D0 	74 5F 72 65 73 65 74 8C 
1A433D8 	C0 33 A4  1 68 40 A0  1 
1A433E0 	14  0  0  0 
d# 21 constant PORT_TEST
1A433E4 	 0  0 70 6F 
1A433E8 	72 74 5F 74 65 73 74 89 
1A433F0 	DC 33 A4  1 68 40 A0  1 
1A433F8 	15  0  0  0 
d# 22 constant PORT_INDICATOR
1A433FC 	 0 70 6F 72 
1A43400 	74 5F 69 6E 64 69 63 61 
1A43408 	74 6F 72 8E F4 33 A4  1 
1A43410 	68 40 A0  1 16  0  0  0 

\ Use tmp-l to make sure that le-l! and le-w! are atomic writes

variable tmp-l
1A43418 	 0  0 74 6D 70 2D 6C 85 
1A43420 	10 34 A4  1 48 40 A0  1 
1A43428 	C0  D  0  0 
: le-w@   ( a -- w )   dup c@ swap ca1+ c@ bwjoin  ;
1A4342C 	 0  0 6C 65 
1A43430 	2D 77 40 85 24 34 A4  1 
1A43438 	20 40 A0  1 40 49 A0  1 
1A43440 	C4 4C A0  1 68 49 A0  1 
1A43448 	78 50 A0  1 C4 4C A0  1 
1A43450 	84 FB A0  1 58 46 A0  1 
: (le-w!) ( w a -- )   >r  wbsplit r@ ca1+ c! r> c!  ;
1A43458 	28 6C 65 2D 77 21 29 87 
1A43460 	38 34 A4  1 20 40 A0  1 
1A43468 	BC 45 A0  1 54 FB A0  1 
1A43470 	E4 45 A0  1 78 50 A0  1 
1A43478 	B8 4D A0  1 D0 45 A0  1 
1A43480 	B8 4D A0  1 58 46 A0  1 
: le-w!   ( w a -- )   swap tmp-l (le-w!) tmp-l w@ swap w!  ;
1A43488 	 0  0 6C 65 2D 77 21 85 
1A43490 	64 34 A4  1 20 40 A0  1 
1A43498 	68 49 A0  1 24 34 A4  1 
1A434A0 	64 34 A4  1 24 34 A4  1 
1A434A8 	94 4C A0  1 68 49 A0  1 
1A434B0 	A4 4D A0  1 58 46 A0  1 

: le-l@   ( a -- l )   >r  r@ c@  r@ 1+ c@  r@ 2+ c@  r> 3 + c@  bljoin  ;
1A434B8 	 0  0 6C 65 2D 6C 40 85 
1A434C0 	94 34 A4  1 20 40 A0  1 
1A434C8 	BC 45 A0  1 E4 45 A0  1 
1A434D0 	C4 4C A0  1 E4 45 A0  1 
1A434D8 	30 4B A0  1 C4 4C A0  1 
1A434E0 	E4 45 A0  1 40 4B A0  1 
1A434E8 	C4 4C A0  1 D0 45 A0  1 
1A434F0 	A0 6F A0  1  4 45 A0  1 
1A434F8 	C4 4C A0  1 DC FB A0  1 
1A43500 	58 46 A0  1 
: (le-l!) ( l a -- )   >r lbsplit  r@ 3 + c!  r@ 2+ c!  r@ 1+ c!  r> c!  ;
1A43504 	28 6C 65 2D 
1A43508 	6C 21 29 87 C4 34 A4  1 
1A43510 	20 40 A0  1 BC 45 A0  1 
1A43518 	B4 FB A0  1 E4 45 A0  1 
1A43520 	A0 6F A0  1  4 45 A0  1 
1A43528 	B8 4D A0  1 E4 45 A0  1 
1A43530 	40 4B A0  1 B8 4D A0  1 
1A43538 	E4 45 A0  1 30 4B A0  1 
1A43540 	B8 4D A0  1 D0 45 A0  1 
1A43548 	B8 4D A0  1 58 46 A0  1 
: le-l!   ( l a -- )   swap tmp-l (le-l!) tmp-l l@ swap l!  ;
1A43550 	 0  0 6C 65 2D 6C 21 85 
1A43558 	10 35 A4  1 20 40 A0  1 
1A43560 	68 49 A0  1 24 34 A4  1 
1A43568 	10 35 A4  1 24 34 A4  1 
1A43570 	6C 4C A0  1 68 49 A0  1 
1A43578 	7C 4D A0  1 58 46 A0  1 


headers

