purpose: USB device driver common routines


\ fl d:include\dev\usbm\error.fth			\ USB error definitions
\ fl d:include\dev\usbm\pkt-data.fth		\ Packet data definitions
\ hcdcallfth  \ ( ) fl d:include\dev\usbm\hcd\hcd-call.fth		\ HCD interface
: commonfth
1A49E18 	 0  0 63 6F 6D 6D 6F 6E 
1A49E20 	66 74 68 89 20 83 A4  1 
1A49E28 	20 40 A0  1 
hex
1A49E2C 	C0 8D A0  1 
hcdcallfth
1A49E30 	70 45 A4  1 
S" 0 value device" eval
1A49E34 	9C 53 A0  1 
1A49E38 	 E 30 20 76 61 6C 75 65 
1A49E40 	20 64 65 76 69 63 65  0 
1A49E48 	D8 E5 A0  1 
S" 0 value configuration" eval
1A49E4C 	9C 53 A0  1 
1A49E50 	15 30 20 76 61 6C 75 65 
1A49E58 	20 63 6F 6E 66 69 67 75 
1A49E60 	72 61 74 69 6F 6E  0  0 
1A49E68 	D8 E5 A0  1 
S" 0 value bulk-in-pipe" eval
1A49E6C 	9C 53 A0  1 
1A49E70 	14 30 20 76 61 6C 75 65 
1A49E78 	20 62 75 6C 6B 2D 69 6E 
1A49E80 	2D 70 69 70 65  0  0  0 
1A49E88 	D8 E5 A0  1 
S" 0 value bulk-out-pipe" eval
1A49E8C 	9C 53 A0  1 
1A49E90 	15 30 20 76 61 6C 75 65 
1A49E98 	20 62 75 6C 6B 2D 6F 75 
1A49EA0 	74 2D 70 69 70 65  0  0 
1A49EA8 	D8 E5 A0  1 
S" 0 value /bulk-in-pipe" eval
1A49EAC 	9C 53 A0  1 
1A49EB0 	15 30 20 76 61 6C 75 65 
1A49EB8 	20 2F 62 75 6C 6B 2D 69 
1A49EC0 	6E 2D 70 69 70 65  0  0 
1A49EC8 	D8 E5 A0  1 
S" 0 value /bulk-out-pipe" eval
1A49ECC 	9C 53 A0  1 
1A49ED0 	16 30 20 76 61 6C 75 65 
1A49ED8 	20 2F 62 75 6C 6B 2D 6F 
1A49EE0 	75 74 2D 70 69 70 65  0 
1A49EE8 	D8 E5 A0  1 
S" 0 value intr-in-pipe" eval
1A49EEC 	9C 53 A0  1 
1A49EF0 	14 30 20 76 61 6C 75 65 
1A49EF8 	20 69 6E 74 72 2D 69 6E 
1A49F00 	2D 70 69 70 65  0  0  0 
1A49F08 	D8 E5 A0  1 
S" 0 value intr-out-pipe" eval
1A49F0C 	9C 53 A0  1 
1A49F10 	15 30 20 76 61 6C 75 65 
1A49F18 	20 69 6E 74 72 2D 6F 75 
1A49F20 	74 2D 70 69 70 65  0  0 
1A49F28 	D8 E5 A0  1 
S" 0 value intr-in-interval" eval
1A49F2C 	9C 53 A0  1 
1A49F30 	18 30 20 76 61 6C 75 65 
1A49F38 	20 69 6E 74 72 2D 69 6E 
1A49F40 	2D 69 6E 74 65 72 76 61 
1A49F48 	6C  0  0  0 D8 E5 A0  1 
S" 0 value intr-out-interval" eval
1A49F50 	9C 53 A0  1 19 30 20 76 
1A49F58 	61 6C 75 65 20 69 6E 74 
1A49F60 	72 2D 6F 75 74 2D 69 6E 
1A49F68 	74 65 72 76 61 6C  0  0 
1A49F70 	D8 E5 A0  1 
S" 0 value /intr-in-pipe" eval
1A49F74 	9C 53 A0  1 
1A49F78 	15 30 20 76 61 6C 75 65 
1A49F80 	20 2F 69 6E 74 72 2D 69 
1A49F88 	6E 2D 70 69 70 65  0  0 
1A49F90 	D8 E5 A0  1 
S" 0 value /intr-out-pipe" eval
1A49F94 	9C 53 A0  1 
1A49F98 	16 30 20 76 61 6C 75 65 
1A49FA0 	20 2F 69 6E 74 72 2D 6F 
1A49FA8 	75 74 2D 70 69 70 65  0 
1A49FB0 	D8 E5 A0  1 
S" 0 value iso-in-pipe" eval
1A49FB4 	9C 53 A0  1 
1A49FB8 	13 30 20 76 61 6C 75 65 
1A49FC0 	20 69 73 6F 2D 69 6E 2D 
1A49FC8 	70 69 70 65  0  0  0  0 
1A49FD0 	D8 E5 A0  1 
S" 0 value iso-out-pipe" eval
1A49FD4 	9C 53 A0  1 
1A49FD8 	14 30 20 76 61 6C 75 65 
1A49FE0 	20 69 73 6F 2D 6F 75 74 
1A49FE8 	2D 70 69 70 65  0  0  0 
1A49FF0 	D8 E5 A0  1 
S" 0 value iso-in-interval" eval
1A49FF4 	9C 53 A0  1 
1A49FF8 	17 30 20 76 61 6C 75 65 
1A4A000 	20 69 73 6F 2D 69 6E 2D 
1A4A008 	69 6E 74 65 72 76 61 6C 
1A4A010 	 0  0  0  0 D8 E5 A0  1 
S" 0 value iso-out-interval" eval
1A4A018 	9C 53 A0  1 18 30 20 76 
1A4A020 	61 6C 75 65 20 69 73 6F 
1A4A028 	2D 6F 75 74 2D 69 6E 74 
1A4A030 	65 72 76 61 6C  0  0  0 
1A4A038 	D8 E5 A0  1 
S" 0 value /iso-in-pipe" eval
1A4A03C 	9C 53 A0  1 
1A4A040 	14 30 20 76 61 6C 75 65 
1A4A048 	20 2F 69 73 6F 2D 69 6E 
1A4A050 	2D 70 69 70 65  0  0  0 
1A4A058 	D8 E5 A0  1 
S" 0 value /iso-out-pipe" eval
1A4A05C 	9C 53 A0  1 
1A4A060 	15 30 20 76 61 6C 75 65 
1A4A068 	20 2F 69 73 6F 2D 6F 75 
1A4A070 	74 2D 70 69 70 65  0  0 
1A4A078 	D8 E5 A0  1 

S" false instance value debug?" eval
1A4A07C 	9C 53 A0  1 
1A4A080 	1B 66 61 6C 73 65 20 69 
1A4A088 	6E 73 74 61 6E 63 65 20 
1A4A090 	76 61 6C 75 65 20 64 65 
1A4A098 	62 75 67 3F  0  0  0  0 
1A4A0A0 	D8 E5 A0  1 

S" : debug-on  ( -- )  true to debug?  ;" eval
1A4A0A4 	9C 53 A0  1 
1A4A0A8 	25 3A 20 64 65 62 75 67 
1A4A0B0 	2D 6F 6E 20 20 28 20 2D 
1A4A0B8 	2D 20 29 20 20 74 72 75 
1A4A0C0 	65 20 74 6F 20 64 65 62 
1A4A0C8 	75 67 3F 20 20 3B  0  0 
1A4A0D0 	D8 E5 A0  1 

S" : get-int-property" eval  ( name$ -- n )
1A4A0D4 	9C 53 A0  1 
1A4A0D8 	12 3A 20 67 65 74 2D 69 
1A4A0E0 	6E 74 2D 70 72 6F 70 65 
1A4A0E8 	72 74 79  0 D8 E5 A0  1 
S"  get-my-property  if  0  else  decode-int nip nip  then ;" eval
1A4A0F0 	9C 53 A0  1 39 20 67 65 
1A4A0F8 	74 2D 6D 79 2D 70 72 6F 
1A4A100 	70 65 72 74 79 20 20 69 
1A4A108 	66 20 20 30 20 20 65 6C 
1A4A110 	73 65 20 20 64 65 63 6F 
1A4A118 	64 65 2D 69 6E 74 20 6E 
1A4A120 	69 70 20 6E 69 70 20 20 
1A4A128 	74 68 65 6E 20 3B  0  0 
1A4A130 	D8 E5 A0  1 

\ This needs to be called every time that the device could have changed
 " : set-device  ( -- ) "" assigned-address""  get-int-property  to device  ;" eval
1A4A134 	9C 53 A0  1 
1A4A138 	48 3A 20 73 65 74 2D 64 
1A4A140 	65 76 69 63 65 20 20 28 
1A4A148 	20 2D 2D 20 29 20 22 20 
1A4A150 	61 73 73 69 67 6E 65 64 
1A4A158 	2D 61 64 64 72 65 73 73 
1A4A160 	22 20 20 67 65 74 2D 69 
1A4A168 	6E 74 2D 70 72 6F 70 65 
1A4A170 	72 74 79 20 20 74 6F 20 
1A4A178 	64 65 76 69 63 65 20 20 
1A4A180 	3B  0  0  0 D8 E5 A0  1 
S" : set-device?  ( -- error?  )  set-device  device -1 =  ;" eval
1A4A188 	9C 53 A0  1 39 3A 20 73 
1A4A190 	65 74 2D 64 65 76 69 63 
1A4A198 	65 3F 20 20 28 20 2D 2D 
1A4A1A0 	20 65 72 72 6F 72 3F 20 
1A4A1A8 	20 29 20 20 73 65 74 2D 
1A4A1B0 	64 65 76 69 63 65 20 20 
1A4A1B8 	64 65 76 69 63 65 20 2D 
1A4A1C0 	31 20 3D 20 20 3B  0  0 
1A4A1C8 	D8 E5 A0  1 


S" : init  ( -- ) set-device" eval
1A4A1CC 	9C 53 A0  1 
1A4A1D0 	19 3A 20 69 6E 69 74 20 
1A4A1D8 	20 28 20 2D 2D 20 29 20 
1A4A1E0 	73 65 74 2D 64 65 76 69 
1A4A1E8 	63 65  0  0 D8 E5 A0  1 
 "  "" configuration#""    get-int-property  to configuration" eval
1A4A1F0 	9C 53 A0  1 38 20 22 20 
1A4A1F8 	63 6F 6E 66 69 67 75 72 
1A4A200 	61 74 69 6F 6E 23 22 20 
1A4A208 	20 20 20 67 65 74 2D 69 
1A4A210 	6E 74 2D 70 72 6F 70 65 
1A4A218 	72 74 79 20 20 74 6F 20 
1A4A220 	63 6F 6E 66 69 67 75 72 
1A4A228 	61 74 69 6F 6E  0  0  0 
1A4A230 	D8 E5 A0  1 
 "  "" bulk-in-pipe""      get-int-property  to bulk-in-pipe" eval
1A4A234 	9C 53 A0  1 
1A4A238 	37 20 22 20 62 75 6C 6B 
1A4A240 	2D 69 6E 2D 70 69 70 65 
1A4A248 	22 20 20 20 20 20 20 67 
1A4A250 	65 74 2D 69 6E 74 2D 70 
1A4A258 	72 6F 70 65 72 74 79 20 
1A4A260 	20 74 6F 20 62 75 6C 6B 
1A4A268 	2D 69 6E 2D 70 69 70 65 
1A4A270 	 0  0  0  0 D8 E5 A0  1 
 "  "" bulk-out-pipe""     get-int-property  to bulk-out-pipe" eval
1A4A278 	9C 53 A0  1 38 20 22 20 
1A4A280 	62 75 6C 6B 2D 6F 75 74 
1A4A288 	2D 70 69 70 65 22 20 20 
1A4A290 	20 20 20 67 65 74 2D 69 
1A4A298 	6E 74 2D 70 72 6F 70 65 
1A4A2A0 	72 74 79 20 20 74 6F 20 
1A4A2A8 	62 75 6C 6B 2D 6F 75 74 
1A4A2B0 	2D 70 69 70 65  0  0  0 
1A4A2B8 	D8 E5 A0  1 
 "  "" bulk-in-size""      get-int-property  to /bulk-in-pipe" eval
1A4A2BC 	9C 53 A0  1 
1A4A2C0 	38 20 22 20 62 75 6C 6B 
1A4A2C8 	2D 69 6E 2D 73 69 7A 65 
1A4A2D0 	22 20 20 20 20 20 20 67 
1A4A2D8 	65 74 2D 69 6E 74 2D 70 
1A4A2E0 	72 6F 70 65 72 74 79 20 
1A4A2E8 	20 74 6F 20 2F 62 75 6C 
1A4A2F0 	6B 2D 69 6E 2D 70 69 70 
1A4A2F8 	65  0  0  0 D8 E5 A0  1 
 "  "" bulk-out-size""     get-int-property  to /bulk-out-pipe" eval
1A4A300 	9C 53 A0  1 39 20 22 20 
1A4A308 	62 75 6C 6B 2D 6F 75 74 
1A4A310 	2D 73 69 7A 65 22 20 20 
1A4A318 	20 20 20 67 65 74 2D 69 
1A4A320 	6E 74 2D 70 72 6F 70 65 
1A4A328 	72 74 79 20 20 74 6F 20 
1A4A330 	2F 62 75 6C 6B 2D 6F 75 
1A4A338 	74 2D 70 69 70 65  0  0 
1A4A340 	D8 E5 A0  1 
 "  "" iso-in-pipe""       get-int-property  to iso-in-pipe" eval
1A4A344 	9C 53 A0  1 
1A4A348 	36 20 22 20 69 73 6F 2D 
1A4A350 	69 6E 2D 70 69 70 65 22 
1A4A358 	20 20 20 20 20 20 20 67 
1A4A360 	65 74 2D 69 6E 74 2D 70 
1A4A368 	72 6F 70 65 72 74 79 20 
1A4A370 	20 74 6F 20 69 73 6F 2D 
1A4A378 	69 6E 2D 70 69 70 65  0 
1A4A380 	D8 E5 A0  1 
 "  "" iso-out-pipe""      get-int-property  to iso-out-pipe" eval
1A4A384 	9C 53 A0  1 
1A4A388 	37 20 22 20 69 73 6F 2D 
1A4A390 	6F 75 74 2D 70 69 70 65 
1A4A398 	22 20 20 20 20 20 20 67 
1A4A3A0 	65 74 2D 69 6E 74 2D 70 
1A4A3A8 	72 6F 70 65 72 74 79 20 
1A4A3B0 	20 74 6F 20 69 73 6F 2D 
1A4A3B8 	6F 75 74 2D 70 69 70 65 
1A4A3C0 	 0  0  0  0 D8 E5 A0  1 
 "  "" iso-in-size""       get-int-property  to /iso-in-pipe" eval
1A4A3C8 	9C 53 A0  1 37 20 22 20 
1A4A3D0 	69 73 6F 2D 69 6E 2D 73 
1A4A3D8 	69 7A 65 22 20 20 20 20 
1A4A3E0 	20 20 20 67 65 74 2D 69 
1A4A3E8 	6E 74 2D 70 72 6F 70 65 
1A4A3F0 	72 74 79 20 20 74 6F 20 
1A4A3F8 	2F 69 73 6F 2D 69 6E 2D 
1A4A400 	70 69 70 65  0  0  0  0 
1A4A408 	D8 E5 A0  1 
 "  "" iso-out-size""      get-int-property  to /iso-out-pipe" eval
1A4A40C 	9C 53 A0  1 
1A4A410 	38 20 22 20 69 73 6F 2D 
1A4A418 	6F 75 74 2D 73 69 7A 65 
1A4A420 	22 20 20 20 20 20 20 67 
1A4A428 	65 74 2D 69 6E 74 2D 70 
1A4A430 	72 6F 70 65 72 74 79 20 
1A4A438 	20 74 6F 20 2F 69 73 6F 
1A4A440 	2D 6F 75 74 2D 70 69 70 
1A4A448 	65  0  0  0 D8 E5 A0  1 
 "  "" iso-in-interval""   get-int-property  to iso-in-interval" eval
1A4A450 	9C 53 A0  1 3A 20 22 20 
1A4A458 	69 73 6F 2D 69 6E 2D 69 
1A4A460 	6E 74 65 72 76 61 6C 22 
1A4A468 	20 20 20 67 65 74 2D 69 
1A4A470 	6E 74 2D 70 72 6F 70 65 
1A4A478 	72 74 79 20 20 74 6F 20 
1A4A480 	69 73 6F 2D 69 6E 2D 69 
1A4A488 	6E 74 65 72 76 61 6C  0 
1A4A490 	D8 E5 A0  1 
 "  "" iso-out-interval""  get-int-property  to iso-out-interval" eval
1A4A494 	9C 53 A0  1 
1A4A498 	3B 20 22 20 69 73 6F 2D 
1A4A4A0 	6F 75 74 2D 69 6E 74 65 
1A4A4A8 	72 76 61 6C 22 20 20 67 
1A4A4B0 	65 74 2D 69 6E 74 2D 70 
1A4A4B8 	72 6F 70 65 72 74 79 20 
1A4A4C0 	20 74 6F 20 69 73 6F 2D 
1A4A4C8 	6F 75 74 2D 69 6E 74 65 
1A4A4D0 	72 76 61 6C  0  0  0  0 
1A4A4D8 	D8 E5 A0  1 
 "  "" intr-in-pipe""      get-int-property  to intr-in-pipe" eval
1A4A4DC 	9C 53 A0  1 
1A4A4E0 	37 20 22 20 69 6E 74 72 
1A4A4E8 	2D 69 6E 2D 70 69 70 65 
1A4A4F0 	22 20 20 20 20 20 20 67 
1A4A4F8 	65 74 2D 69 6E 74 2D 70 
1A4A500 	72 6F 70 65 72 74 79 20 
1A4A508 	20 74 6F 20 69 6E 74 72 
1A4A510 	2D 69 6E 2D 70 69 70 65 
1A4A518 	 0  0  0  0 D8 E5 A0  1 
 "  "" intr-out-pipe""     get-int-property  to intr-out-pipe" eval
1A4A520 	9C 53 A0  1 38 20 22 20 
1A4A528 	69 6E 74 72 2D 6F 75 74 
1A4A530 	2D 70 69 70 65 22 20 20 
1A4A538 	20 20 20 67 65 74 2D 69 
1A4A540 	6E 74 2D 70 72 6F 70 65 
1A4A548 	72 74 79 20 20 74 6F 20 
1A4A550 	69 6E 74 72 2D 6F 75 74 
1A4A558 	2D 70 69 70 65  0  0  0 
1A4A560 	D8 E5 A0  1 
 "  "" intr-in-size""      get-int-property  to /intr-in-pipe" eval
1A4A564 	9C 53 A0  1 
1A4A568 	38 20 22 20 69 6E 74 72 
1A4A570 	2D 69 6E 2D 73 69 7A 65 
1A4A578 	22 20 20 20 20 20 20 67 
1A4A580 	65 74 2D 69 6E 74 2D 70 
1A4A588 	72 6F 70 65 72 74 79 20 
1A4A590 	20 74 6F 20 2F 69 6E 74 
1A4A598 	72 2D 69 6E 2D 70 69 70 
1A4A5A0 	65  0  0  0 D8 E5 A0  1 
 "  "" intr-out-size""     get-int-property  to /intr-out-pipe" eval
1A4A5A8 	9C 53 A0  1 39 20 22 20 
1A4A5B0 	69 6E 74 72 2D 6F 75 74 
1A4A5B8 	2D 73 69 7A 65 22 20 20 
1A4A5C0 	20 20 20 67 65 74 2D 69 
1A4A5C8 	6E 74 2D 70 72 6F 70 65 
1A4A5D0 	72 74 79 20 20 74 6F 20 
1A4A5D8 	2F 69 6E 74 72 2D 6F 75 
1A4A5E0 	74 2D 70 69 70 65  0  0 
1A4A5E8 	D8 E5 A0  1 
 "  "" intr-in-interval""  get-int-property  to intr-in-interval" eval
1A4A5EC 	9C 53 A0  1 
1A4A5F0 	3B 20 22 20 69 6E 74 72 
1A4A5F8 	2D 69 6E 2D 69 6E 74 65 
1A4A600 	72 76 61 6C 22 20 20 67 
1A4A608 	65 74 2D 69 6E 74 2D 70 
1A4A610 	72 6F 70 65 72 74 79 20 
1A4A618 	20 74 6F 20 69 6E 74 72 
1A4A620 	2D 69 6E 2D 69 6E 74 65 
1A4A628 	72 76 61 6C  0  0  0  0 
1A4A630 	D8 E5 A0  1 
 "  "" intr-out-interval"" get-int-property  to intr-out-interval ;" eval
1A4A634 	9C 53 A0  1 
1A4A638 	3E 20 22 20 69 6E 74 72 
1A4A640 	2D 6F 75 74 2D 69 6E 74 
1A4A648 	65 72 76 61 6C 22 20 67 
1A4A650 	65 74 2D 69 6E 74 2D 70 
1A4A658 	72 6F 70 65 72 74 79 20 
1A4A660 	20 74 6F 20 69 6E 74 72 
1A4A668 	2D 6F 75 74 2D 69 6E 74 
1A4A670 	65 72 76 61 6C 20 3B  0 
1A4A678 	D8 E5 A0  1 
;
1A4A67C 	58 46 A0  1 

